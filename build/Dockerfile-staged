FROM golang:1.22.1 as build

ARG VERSION

WORKDIR /build
COPY . .
RUN chmod +x build.sh
RUN ./build.sh $VERSION

FROM alpine

RUN echo $VERSION $COMMAND ${subCmd}
ARG COMMAND
ENV subCmd=$COMMAND

COPY --from=build /build/solaredge /app/solaredge
RUN echo /app/solaredge ${subCmd} > /app/entrypoint.sh
RUN chmod +x /app/entrypoint.sh
ENTRYPOINT ["/bin/sh", "-c", "/app/entrypoint.sh"]
CMD []
