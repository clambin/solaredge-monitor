FROM golang:1.22.1 as build

ARG REPO
ARG BINARY
ARG COMMAND
ARG VERSION

RUN CGO_ENABLED=0 \
    go build \
      -o $BINARY \
      -ldflags "-X main.version=$VERSION" \
      $REPO/cmd/$BINARY/$BINARY.go

FROM alpine
COPY --from=build /go/$BINARY /app/$BINARY
ENTRYPOINT ["/app/$BINARY $COMMAND"]
CMD []
