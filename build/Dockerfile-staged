FROM golang:1.22.1 as build

ARG VERSION
ARG COMMAND
ENV subCmd=$COMMAND

WORKDIR /build
COPY . .
#RUN CGO_ENABLED=0 go build -o $BINARY -ldflags \"-X main.version=$VERSION\" cmd/$BINARY/$BINARY.go
RUN chmod +x build.sh
RUN ./build.sh $VERSION

FROM alpine
COPY --from=build /build/solaredge /app/solaredge
ENTRYPOINT exec /app/solaredge $subCmd
CMD []
