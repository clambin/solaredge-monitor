FROM golang:1.22.1 as build

ARG BINARY
ARG COMMAND
ARG VERSION

#WORKDIR /go
#RUN CGO_ENABLED=0 go build -o $BINARY -ldflags \"-X main.version=$VERSION\" cmd/$BINARY/$BINARY.go
RUN ls src
RUN find . -name Dockerfile-staged -print
RUN chmod +x build.sh
RUN ./build.sh $VERSION

FROM alpine
COPY --from=build /go/$BINARY /app/$BINARY
ENTRYPOINT ["/app/$BINARY", "$COMMAND"]
CMD []
